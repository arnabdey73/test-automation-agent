import{j as e}from"./jsx-runtime.CnDyYxjH.js";import{r as s}from"./index.ByUVKm3p.js";function t(){const[t,r]=s.useState([]),[a,n]=s.useState({isRecording:!1,currentSession:null,url:""}),[l,i]=s.useState(0),[o,d]=s.useState(null),[c,m]=s.useState(null),[u,x]=s.useState({stepDelay:1e3,takeScreenshots:!0}),[h,p]=s.useState(!1),[b,g]=s.useState({show:!1,message:"",type:"info"}),[y,j]=s.useState(null);s.useEffect((()=>{N()}),[]),s.useEffect((()=>{if(b.show){const e=setTimeout((()=>{g({...b,show:!1})}),5e3);return()=>clearTimeout(e)}}),[b]),s.useEffect((()=>()=>{o&&clearInterval(o)}),[o]);const f=(e,s="info")=>{g({show:!0,message:e,type:s})},N=async()=>{try{const e=await fetch("/api/manual-test/sessions"),s=await e.json();s.success?r(s.sessions):f("Failed to load sessions: "+(s.error||"Unknown error"),"error")}catch(e){f("Failed to load sessions. Check network connection.","error")}};return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Manual Test Simulator"}),b.show&&e.jsx("div",{className:"mb-4 p-4 rounded-md "+("success"===b.type?"bg-green-100 border-green-400 text-green-700":"error"===b.type?"bg-red-100 border-red-400 text-red-700":"bg-blue-100 border-blue-400 text-blue-700"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"success"===b.type?"✅":"error"===b.type?"❌":"ℹ️"}),e.jsx("p",{children:b.message}),e.jsx("button",{onClick:()=>g({...b,show:!1}),className:"ml-auto text-gray-500 hover:text-gray-700","aria-label":"Close notification",children:"✕"})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Confirm Deletion"}),e.jsx("p",{className:"mb-6",children:"Are you sure you want to delete this session and all related files? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{j(null)},className:"px-4 py-2 border rounded-md hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(y){p(!0);try{const e=await fetch(`/api/manual-test/sessions/${y}`,{method:"DELETE"}),s=await e.json();s.success?(f("Session deleted successfully","success"),N()):f("Failed to delete session: "+(s.error||"Unknown error"),"error")}catch(e){f("Failed to delete session. Check network connection.","error")}p(!1),j(null)}},className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",children:"Delete"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Record Manual Test"}),a.isRecording?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-pulse bg-red-500 w-3 h-3 rounded-full mr-2"}),e.jsx("p",{className:"text-red-700 font-medium",children:"Recording in progress..."})]}),e.jsxs("p",{className:"text-red-600 mt-1",children:["Session: ",a.currentSession?.sessionId]}),e.jsxs("p",{className:"text-red-600 mt-1",children:["Elapsed Time: ",Math.floor(l/60),":",String(l%60).padStart(2,"0")]})]}),e.jsx("button",{onClick:async()=>{p(!0),o&&(clearInterval(o),d(null));try{const e=a.currentSession?.sessionId,s=await fetch("/api/manual-test/record/stop",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e})}),t=await s.json();t.success?(n({isRecording:!1,currentSession:null,url:""}),f("Recording stopped successfully","success"),N()):f("Failed to stop recording: "+(t.error||"Unknown error"),"error")}catch(e){f("Failed to stop recording. Check network connection.","error")}p(!1)},disabled:h,className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:h?"Stopping...":"Stop Recording"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Starting URL:"}),e.jsx("input",{type:"url",value:a.url,onChange:e=>n({...a,url:e.target.value}),placeholder:"https://example.com",className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("button",{onClick:async()=>{if(!a.url)return void f("Please enter a URL to start recording","error");const e=`manual_test_${Date.now()}`,s=`Manual Test ${(new Date).toLocaleString()}`;p(!0);try{const t=await fetch("/api/manual-test/record/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:a.url,sessionId:e,testName:s})}),r=await t.json();if(r.success){n({...a,isRecording:!0,currentSession:r.session}),i(0);const e=setInterval((()=>{i((e=>e+1))}),1e3);d(e),f("Recording started successfully","success")}else f("Failed to start recording: "+(r.error||"Unknown error"),"error")}catch(t){f("Failed to start recording. Check network connection.","error")}p(!1)},disabled:h||!a.url,className:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 disabled:opacity-50",children:h?"Starting...":"Start Recording"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Replay Options"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stepDelay",className:"block text-sm font-medium mb-2",children:"Step Delay (ms):"}),e.jsx("input",{id:"stepDelay",type:"number",value:u.stepDelay,onChange:e=>x({...u,stepDelay:parseInt(e.target.value)}),"aria-label":"Step Delay in milliseconds",title:"Time delay between steps during replay",className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"takeScreenshots",type:"checkbox",checked:u.takeScreenshots,onChange:e=>x({...u,takeScreenshots:e.target.checked}),"aria-label":"Take screenshots during replay",title:"Take screenshots during replay",className:"mr-2"}),e.jsx("label",{htmlFor:"takeScreenshots",className:"text-sm font-medium",children:"Take Screenshots"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Recorded Sessions"}),0===t.length?e.jsx("p",{className:"text-gray-500",children:"No recorded sessions yet."}):e.jsx("div",{className:"space-y-3",children:t.map((s=>e.jsxs("div",{className:"border rounded-md p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.sessionId}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"inline-flex items-center bg-gray-100 px-2 py-0.5 rounded text-xs font-medium mr-2",children:[s.totalSteps," steps"]}),e.jsxs("span",{className:"inline-flex items-center bg-gray-100 px-2 py-0.5 rounded text-xs font-medium mr-2",children:[Math.round(s.duration/1e3),"s"]}),e.jsx("span",{className:"text-gray-500",children:new Date(s.createdAt).toLocaleString()})]})]}),e.jsxs("div",{className:"space-x-2 flex items-center",children:[e.jsx("button",{onClick:()=>m(c?.sessionId===s.sessionId?null:s),className:"text-blue-500 hover:text-blue-700 px-3 py-1 rounded-md border border-blue-200 hover:border-blue-400","aria-label":c?.sessionId===s.sessionId?"Hide session details":"View session details",children:c?.sessionId===s.sessionId?"Hide":"View"}),e.jsx("button",{onClick:()=>(async e=>{p(!0);try{const s=await fetch(`/api/manual-test/replay/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),t=await s.json();t.success?f(`Replay completed with ${t.result.steps.length} steps`,"success"):f("Failed to replay session: "+(t.error||"Unknown error"),"error")}catch(s){f("Failed to replay session. Check network connection.","error")}p(!1)})(s.sessionId),disabled:h,className:"bg-green-500 text-white px-3 py-1 rounded-md hover:bg-green-600 disabled:opacity-50","aria-label":"Replay this session",children:"Replay"}),e.jsx("button",{onClick:()=>(async e=>{j(e)})(s.sessionId),disabled:h,className:"bg-red-100 text-red-600 px-3 py-1 rounded-md hover:bg-red-200 disabled:opacity-50","aria-label":"Delete this session",children:"Delete"})]})]}),c?.sessionId===s.sessionId&&e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Steps:"}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto p-2 border rounded bg-gray-50",children:[s.steps.map(((s,t)=>e.jsxs("div",{className:"text-sm bg-white p-3 rounded shadow-sm border-l-4 border-l-blue-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\n                                "+("click"===s.type?"bg-green-100 text-green-800":"input"===s.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:s.type.toUpperCase()})}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsxs("div",{className:"mt-1",children:[s.selector&&e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Selector:"})," ",e.jsx("code",{className:"bg-gray-100 px-1 py-0.5 rounded",children:s.selector})]}),s.value&&e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Value:"})," ",e.jsxs("span",{className:"text-blue-600",children:['"',s.value,'"']})]}),s.text&&e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Text:"})," ",e.jsxs("span",{className:"text-gray-600",children:['"',s.text,'"']})]}),s.url&&e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"URL:"})," ",e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline break-all",children:s.url})]}),s.error&&e.jsxs("div",{className:"text-red-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Error:"})," ",s.error]})]})]},t))),0===s.steps.length&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No steps recorded in this session"})]})]})]},s.sessionId)))})]})]})}export{t as default};
